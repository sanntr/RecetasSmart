{% extends 'navbar.html' %}

{% block content %}
<div class="container mt-4">
    <h2>üç≥ Crear Receta</h2>
    <form method="post" class="row g-3" id="recetaForm">
        {% csrf_token %}

        <div class="col-12">
            <label class="form-label">T√≠tulo</label>
            {{ receta_form.titulo }}
        </div>

        <div class="col-12">
            <label class="form-label">Pasos</label>
            {{ receta_form.pasos_receta }}
        </div>

        <h4 class="mt-4">ü•ó Productos</h4>
        {{ formset.management_form }}

        <div id="productos-formset">
            {% for form in formset %}
                <div class="row g-2 mb-2 border p-2 rounded formset-form">
                    <div class="col-md-6">
                        {{ form.producto }}
                    </div>
                    <div class="col-md-4">
                        {{ form.cantidad_uso }}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Bot√≥n para a√±adir m√°s productos -->
        <div class="col-12 mb-3">
            <button type="button" class="btn btn-outline-primary w-100" id="add-producto">
                ‚ûï Agregar producto
            </button>
        </div>

        <div class="col-12">
            <button type="submit" class="btn btn-success w-100">Guardar Receta</button>
        </div>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let formsetDiv = document.getElementById("productos-formset");
    let addBtn = document.getElementById("add-producto");
    let totalForms = document.querySelector("[id$='-TOTAL_FORMS']"); // ‚úÖ din√°mico

    addBtn.addEventListener("click", function () {
        let currentFormCount = parseInt(totalForms.value);
        let emptyFormHtml = `{{ formset.empty_form.as_p|escapejs }}`;

        // Reemplazar __prefix__ por el n√∫mero del formulario nuevo
        emptyFormHtml = emptyFormHtml.replace(/__prefix__/g, currentFormCount);

        // Crear un contenedor para el nuevo formulario
        let div = document.createElement("div");
        div.classList.add("row", "g-2", "mb-2", "border", "p-2", "rounded", "formset-form");
        div.innerHTML = emptyFormHtml;

        formsetDiv.appendChild(div);

        // Aumentar el contador de formularios
        totalForms.value = currentFormCount + 1;
    });
});
</script>
{% endblock %}
